---
layout:     post
title:      Setting up and Hosting a Secure Website in AWS
date:       2019-11-15 09:45:12
summary:    Summary for week 12.
categories: jekyll pixyll
---

Developing a website from scratch involved a lot of work and often requires skills such as HTML, CSS, and Javascript.
However, regardless of how complete and beautiful your website is the one thing that it should always have is a secure conntection.

The best option for website's end-to-end secure web connection is Transport Layer Security, more commonly knows as TLS / SSL.
In order to have a utilize TLS, a website requires a certificate that would verify its identity.

Amazon Web Services provide all the neceessary tools required for hosting a website.
In additiona, AWS provides tool that will handle your website's traffic and TLS encryptions.

<b>To host a website use ec2-instance: </b><br/>
1.) Create a configure an ec2-instance with all the necessary settings, os such as Ubuntu, with a public ip and security groups for SSH, HTTP, and HTTPS
2.) Once your instance is running, connect to it and install the required packages, apache2 server is a popular choice
3.) Develop your website and add it to a default location of your server - for apache2 default is "/var/www/html/index.html" (default can be changed)
4.) Start your server
5.) Open any web browser and enter your ec2-instance's public ip. You should see your website's page

The steps above have your website running, but it does not have a domain, the traffic is not balancer, and connection is not secure.
There are a few ways to make your website secure, however, the preferred way in AWS is through an Elastic Load Balancer.

Before we can create a load balancer we need a certificate.
There are many tools that will allow us to get a certificate.
Certbot was a tool of my choice as it is free to use.

<b>Crating a Load Balancer with Secure connection: </b><br/>
1.) Follow the Certbot website instruction to generate a cert-bot certificate (make sure to include all domains ex: www), but save the files locally
2.) Use the certificate files to import the certificate into AWS Certificate Manager
3.) Create a load balancer on the same VPC and using the same Security Group as your ec2-instance that it is linked to
4.) When prompted for HTTPS certificate, make sure load balancer is linked to AWS Certificate created previously
5.) After about 5 minutes after creation, test ELB domain name in the web browser and it should show the ec2-instance's webpage

Now that the connection is secure and balancer, it needs to be linked to a Domain Name.

<b>Connecting Load Balancer with Domain Name Through Route 53: </b><br/>
1.) Create a Route 53 Hosted Zone for your main domain name
2.) Create A ("alias") type records to connect your domain name(s) to the Load Balancer (additional record for "www")
3.) In your Domain Name Provider, insert the Domain Name servers generated by Route 53 hosted zone
4.) After some time (between 15 minutes up to 2 days) the website hosted by ec2-instance should be visible through the domain names.

While the connection is now secure and website is now hosted, the secured connection needs to be enforced to prevent accidental unencryted usage.

<b>Changing Apache2 Config File to enforce secure connection: /b><br/>
1.) Locate your apache2 configuration file (on Ubuntu /etc/apache2/apache2.conf) and add the following:

<VirtualHost *:80>
RewriteEngine On
RewriteCond %{HTTP:X-Forwarded-Proto} =http
RewriteRule .* https://%{HTTP:Host}%{REQUEST_URI} [L,R=permanent]
</VirtualHost>

2.) Restart Apache2 service
3.) Access your website through the web brower, connection should be automatically routed to HTTPS, even if HTTP is requested

